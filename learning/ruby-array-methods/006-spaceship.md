# Array#<=>

- 日付: 2026-01-06
- URL: https://docs.ruby-lang.org/en/4.0/Array.html#method-i-3C-3D-3E

## 基本情報

**メソッドシグネチャ:**
```ruby
self <=> other_array → -1, 0, or 1
```

**通称:** 宇宙船演算子（Spaceship Operator）

**概要:**
`self` が `other_array` より小さい、等しい、大きいと判断される場合、それぞれ `-1`、`0`、`1` を返します。

## メモ（daily より）

`self <=> other_array → -1, 0, or 1`、通称「宇宙船演算子」

## 深掘り・補足

### 動作の仕組み

配列の比較は以下の手順で行われます：

1. **各インデックス i について (0...self.size) を反復処理**
   - `result[i] = self[i] <=> other_array[i]` を計算

2. **結果に応じた処理**
   - `result[i]` が `1` の場合、直ちに `1` を返す
   - `result[i]` が `-1` の場合、直ちに `-1` を返す
   - `result[i]` が `0` の場合、次の要素の比較に進む

3. **全ての要素が等しい場合**
   - `self.size <=> other_array.size` を返す（配列の長さを比較）

### 実例

```ruby
# 要素の比較で決まる場合
[0, 1, 2] <=> [0, 0, 2] # => 1  (2番目の要素で self の方が大きい)
[0, 1, 2] <=> [0, 2, 2] # => -1 (2番目の要素で self の方が小さい)

# 長さの比較で決まる場合
[0, 1, 2] <=> [0, 1]        # => 1  (self の方が長い)
[0, 1, 2] <=> [0, 1, 2]     # => 0  (完全に等しい)
[0, 1, 2] <=> [0, 1, 2, 3]  # => -1 (self の方が短い)
```

### 重要な注意点

**other_array が self より長い場合の挙動**

`other_array` の末尾の要素は結果に影響しません：

```ruby
[0, 1, 2] <=> [0, 1, 2, -3] # => -1 (長さの比較のみ)
[0, 1, 2] <=> [0, 1, 2, 0]  # => -1 (長さの比較のみ)
[0, 1, 2] <=> [0, 1, 2, 3]  # => -1 (長さの比較のみ)
```

最初の3要素が等しいため、長さの比較で `self.size (3) <=> other_array.size (4)` = `-1` となります。

### ユースケース

**配列のソート**
```ruby
arrays = [[3, 1], [1, 2], [2, 1], [1, 1]]
sorted = arrays.sort  # <=> が内部で使われる
# => [[1, 1], [1, 2], [2, 1], [3, 1]]
```

**条件分岐**
```ruby
case array1 <=> array2
when -1
  puts "array1 is smaller"
when 0
  puts "arrays are equal"
when 1
  puts "array1 is greater"
end
```

### パフォーマンスの考慮事項

- 要素ごとに `<=>` を呼び出すため、要素数に比例した計算量 (O(n))
- 違いが見つかった時点で即座に結果を返すため、早期終了の可能性あり
- 配列の要素が複雑なオブジェクトの場合、そのオブジェクトの `<=>` 実装に依存

### 関連メソッド

- `Array#==`: 完全一致の判定（`<=>` が `0` を返すかの判定）
- `Array#eql?`: より厳密な等価性判定
- `Comparable` モジュール: `<=>` を実装すると `<`, `<=`, `>`, `>=`, `==`, `between?` が使えるようになる

### まとめ

`<=>` は配列の大小比較を行う基本的なメソッドで、ソートや順序付けに不可欠です。要素を先頭から順に比較し、違いが見つかった時点で結果を返すため効率的です。
