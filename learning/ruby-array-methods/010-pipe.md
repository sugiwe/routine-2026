# Array#|

- 日付: 2026-01-10
- URL: https://docs.ruby-lang.org/en/4.0/Array.html#method-i-7C

## 基本情報

```ruby
self | other_array → new_array
```

自身と `other_array` の和集合（union）を返します。重複は削除され、順序は保持されます。要素は `eql?` を使用して比較されます。

## daily からの記録

### メモ

`self | other_array → new_array`

### コード例・補足

```ruby
# Returns the union of self and other_array; duplicates are removed; order is preserved; items are compared using eql?:
# 自身と other_array の和集合を返します。重複は削除され、順序は保持されます。要素は eql? を使用して比較されます。
[0, 1] | [2, 3] # => [0, 1, 2, 3]
[0, 1, 1] | [2, 2, 3] # => [0, 1, 2, 3]
[0, 1, 2] | [3, 2, 1, 0] # => [0, 1, 2, 3]
```

## 深掘り・補足

### 重要なポイント

1. **和集合の定義**
   - 数学的な和集合演算を配列に適用
   - 両方の配列からすべての**一意な要素**を含む新しい配列を返す
   - 元の配列は変更されない（非破壊的メソッド）

2. **重複の削除**
   - 同じ配列内の重複も削除される
   - 異なる配列間の重複も削除される
   - 最初に出現した要素が保持される

3. **順序の保持**
   - `self` の要素が先に配置される
   - その後、`other_array` の新しい要素が追加される
   - 各配列内での元の順序は維持される

4. **比較方法**
   - 要素の比較には `eql?` メソッドを使用
   - `==` ではなく `eql?` なので、型も含めて厳密に比較される

### ユースケース

#### 1. **重複のないリストの結合**

```ruby
# ユーザーの興味タグを統合
user_tags = ["ruby", "rails", "javascript"]
admin_tags = ["javascript", "python", "devops"]

all_tags = user_tags | admin_tags
# => ["ruby", "rails", "javascript", "python", "devops"]
```

#### 2. **複数のデータソースからの一意な値の収集**

```ruby
# 複数のログファイルからエラーコードを収集
errors_file1 = [404, 500, 404, 403]
errors_file2 = [500, 502, 404]

unique_errors = errors_file1 | errors_file2
# => [404, 500, 403, 502]
```

#### 3. **権限やロールの統合**

```ruby
# ユーザーの基本権限と追加権限を統合
base_permissions = [:read, :write]
extra_permissions = [:write, :delete, :admin]

all_permissions = base_permissions | extra_permissions
# => [:read, :write, :delete, :admin]
```

### 注意点

#### 1. **eql? と == の違い**

```ruby
# 数値型の違いに注意
[1, 2] | [2.0, 3]  # => [1, 2, 2.0, 3]
# 1.eql?(1.0) は false なので、2 と 2.0 は別の要素として扱われる
```

#### 2. **パフォーマンス**

```ruby
# 大きな配列の場合、パフォーマンスに注意
# 内部的にハッシュを使用するため、O(n + m) の時間計算量
large_array1 = (1..10000).to_a
large_array2 = (5000..15000).to_a

result = large_array1 | large_array2  # 効率的に処理される
```

#### 3. **順序の重要性**

```ruby
# 左右の配列を入れ替えると結果の順序が変わる
[1, 2, 3] | [4, 5, 6]  # => [1, 2, 3, 4, 5, 6]
[4, 5, 6] | [1, 2, 3]  # => [4, 5, 6, 1, 2, 3]
```

### 関連メソッドとの比較

#### `Array#+` との違い

```ruby
# + は重複を削除しない
[1, 2] + [2, 3]  # => [1, 2, 2, 3]

# | は重複を削除する
[1, 2] | [2, 3]  # => [1, 2, 3]
```

#### `Array#&`（積集合）との対比

```ruby
# & は共通要素のみを返す
[1, 2, 3] & [2, 3, 4]  # => [2, 3]

# | はすべての一意な要素を返す
[1, 2, 3] | [2, 3, 4]  # => [1, 2, 3, 4]
```

#### `Array#-`（差集合）との対比

```ruby
# - は左側の配列から右側の要素を削除
[1, 2, 3] - [2, 3, 4]  # => [1]

# | は両方の要素を統合
[1, 2, 3] | [2, 3, 4]  # => [1, 2, 3, 4]
```

#### `Array#uniq` との組み合わせ

```ruby
# 単一配列の重複削除には uniq を使用
[1, 2, 2, 3].uniq  # => [1, 2, 3]

# | は 2 つの配列の統合 + 重複削除
[1, 2, 2] | [3, 3, 4]  # => [1, 2, 3, 4]
```

### 実践的なパターン

#### 複数配列の和集合

```ruby
# 3 つ以上の配列の和集合を取る
array1 = [1, 2]
array2 = [2, 3]
array3 = [3, 4]

result = array1 | array2 | array3  # => [1, 2, 3, 4]
```

#### 条件付きでの要素追加

```ruby
# 既存の配列に条件付きで要素を追加（重複を避ける）
tags = ["ruby", "rails"]
new_tag = "ruby"  # 既に存在

tags = tags | [new_tag]  # => ["ruby", "rails"]
```

### まとめ

`Array#|` は配列の和集合を求めるための便利なメソッドで、重複を自動的に削除しながら 2 つの配列を統合します。データの統合、一意な値のリスト作成、タグやカテゴリーの管理など、様々な場面で活用できます。順序の保持と `eql?` による比較を理解して使用することが重要です。
