# Array#at

- 日付: 2026-01-15
- URL: https://docs.ruby-lang.org/en/4.0/Array.html#method-i-at

## 基本情報

```ruby
at(index) → object or nil
```

指定されたインデックスに対応する配列の要素を返します。要素が存在しない場合は `nil` を返します。インデックスは整数に変換可能なオブジェクトである必要があります。

## daily からの記録

### メモ

`at(index) → object or nil`

### コード例・補足

```ruby
# Returns the element of self specified by the given index or nil if there is no such element; index must be an integer-convertible object.
# 指定されたインデックスの要素を返します。そのような要素がない場合はnilを返します。インデックスは整数に変換可能なオブジェクトである必要があります。

# For non-negative index, returns the element of self at offset index:
# 非負のインデックスが指定された場合、指定されたオフセットの要素を返します。
a = [:foo, 'bar', 2]
a.at(0)   # => :foo
a.at(2)   # => 2
a.at(2.0) # => 2

# For negative index, counts backwards from the end of self:
# 負のインデックスの場合、self の末尾から逆順にカウントします。
a.at(-2) # => "bar"
```

## 深掘り・補足

### 重要なポイント

1. **負のインデックスに対応**
   - `-1` は最後の要素
   - `-2` は後ろから2番目の要素
   - 配列の末尾からアクセスする際に便利

2. **範囲外アクセスは `nil` を返す**
   - 存在しないインデックスを指定してもエラーにならない
   - `nil` が返るため、安全にアクセス可能

3. **整数変換可能なオブジェクトを受け付ける**
   - `2.0` のような Float も受け付けられる
   - 内部的に整数に変換される

### ユースケース

```ruby
arr = ['apple', 'banana', 'cherry', 'date']

# 先頭要素へのアクセス
arr.at(0)   # => 'apple'

# 最後の要素へのアクセス（負のインデックス）
arr.at(-1)  # => 'date'

# 範囲外へのアクセス（エラーにならない）
arr.at(10)  # => nil
arr.at(-10) # => nil
```

### 注意点

- **範囲外アクセスの検出が必要な場合**: `at` は `nil` を返すため、意図しない範囲外アクセスを見逃す可能性があります。範囲外アクセス時にエラーを発生させたい場合は `fetch` メソッドを使用してください。

```ruby
arr = ['a', 'b', 'c']
arr.at(10)    # => nil（エラーにならない）
arr.fetch(10) # => IndexError: index 10 outside of array bounds
```

### 関連メソッドとの比較

| メソッド | 範囲外アクセス | 複数要素取得 | 範囲指定 | 一般的な用途 |
|---------|--------------|------------|--------|------------|
| `at(index)` | `nil` を返す | 不可 | 不可 | 単一要素へのシンプルなアクセス |
| `[index]` | `nil` を返す | 可能 | 可能 | 最も汎用的な要素アクセス |
| `fetch(index)` | エラーまたはデフォルト値 | 不可 | 不可 | 安全性を重視したアクセス |

### `[]` との違い

`at` と `[]` は基本的に同じ動作をしますが、以下の点で異なります：

```ruby
arr = ['a', 'b', 'c']

# 単一要素のアクセス（同じ動作）
arr.at(0)  # => 'a'
arr[0]     # => 'a'

# 複数要素の取得（[] のみ対応）
arr[0, 2]  # => ['a', 'b']
# arr.at(0, 2) # => エラー（at は複数引数を受け付けない）

# 範囲指定（[] のみ対応）
arr[0..1]  # => ['a', 'b']
# arr.at(0..1) # => エラー（at は範囲を受け付けない）
```

### まとめ

`Array#at` は、配列の単一要素にアクセスするためのシンプルなメソッドです。`[]` と同じ動作をしますが、単一要素へのアクセスに特化しています。実務では `[]` の方が汎用性が高く広く使われていますが、`at` を使うことでコードの意図（単一要素へのアクセス）を明確にできる場合があります。