# Array#max

- 日付: 2026-03-02
- URL: https://docs.ruby-lang.org/en/4.0/Array.html#method-i-max
- daily 記録: [daily/2026-03-02.md](../../daily/2026-03-02.md)

## 基本情報

**メソッドシグネチャ：**
```ruby
max → element
max(n) → new_array
max {|a, b| ... } → element
max(n) {|a, b| ... } → new_array
```

**概要：**
配列内の最大値要素を返すメソッドです。引数やブロックの有無により、単一要素または複数要素の配列を返します。

## ユーザーの学習記録（daily より）

### 第一印象のメモ

（メモなし）

### コード例

```ruby
# Returns one of the following:
# 以下のいずれかを返します：
# - The maximum-valued element from self.
# - 自身の最大値要素。
# - A new array of maximum-valued elements from self.
# - 自身の要素から、最大値を持つ要素だけを集めた新しい配列。

# Does not modify self.
# 自身を変更しません。

# With no block given, each element in self must respond to method <=> with a numeric.
# ブロックが指定されていない場合、selfの各要素は<=>メソッドに数値で応答する必要があります。
# With no argument and no block, returns the element in self having the maximum value per method <=>:
# 引数もブロックもなしで、`<=>` メソッドによって最大の値を返す要素を返します。
[1, 0, 3, 2].max # => 3

# With non-negative numeric argument count and no block, returns a new array with at most count elements, in descending order, per method <=>:
# 負ではない数値の引数`count`を指定しブロックを渡さない場合、`count`個以下の要素を持つ新しい配列を返します。要素は`<=>`メソッドによる降順でソートされます。
[1, 0, 3, 2].max(3)   # => [3, 2, 1]
[1, 0, 3, 2].max(3.0) # => [3, 2, 1]
[1, 0, 3, 2].max(9)   # => [3, 2, 1, 0]
[1, 0, 3, 2].max(0)   # => []

# With a block given, the block must return a numeric.

# With a block and no argument, calls the block self.size - 1 times to compare elements; returns the element having the maximum value per the block:

['0', '', '000', '00'].max {|a, b| a.size <=> b.size }
# => "000"

# With non-negative numeric argument count and a block, returns a new array with at most count elements, in descending order, per the block:

['0', '', '000', '00'].max(2) {|a, b| a.size <=> b.size }
# => ["000", "00"]
```

## 深掘り・補足

### 重要なポイント

1. **非破壊的メソッド**
   - 元の配列は変更されません
   - 新しい値または配列を返します

2. **4 つの使い方**
   - `max`: 最大値を 1 つ返す
   - `max(n)`: 上位 n 個を降順で返す
   - `max { block }`: ブロックの比較ロジックで最大値を返す
   - `max(n) { block }`: ブロックの比較ロジックで上位 n 個を返す

3. **比較の仕組み**
   - デフォルトは `<=>` 演算子を使用
   - ブロックを渡すことでカスタム比較が可能

### ユースケース

**数値配列の最大値取得：**
```ruby
scores = [85, 92, 78, 95, 88]
highest = scores.max  # => 95
top_3 = scores.max(3) # => [95, 92, 88]
```

**カスタム比較（文字列の長さ）：**
```ruby
words = ['apple', 'banana', 'kiwi', 'strawberry']
longest = words.max {|a, b| a.length <=> b.length }
# => "strawberry"

top_2_longest = words.max(2) {|a, b| a.length <=> b.length }
# => ["strawberry", "banana"]
```

**オブジェクト配列の最大値：**
```ruby
users = [
  {name: 'Alice', age: 30},
  {name: 'Bob', age: 25},
  {name: 'Charlie', age: 35}
]

oldest = users.max {|a, b| a[:age] <=> b[:age] }
# => {name: 'Charlie', age: 35}
```

### 注意点

1. **引数 n が配列サイズを超える場合**
   - すべての要素を降順で返す
   - エラーにはならない

2. **空配列の場合**
   ```ruby
   [].max     # => nil
   [].max(3)  # => []
   ```

3. **比較不可能な要素の場合**
   ```ruby
   [1, 'two', 3].max  # => ArgumentError (comparison failed)
   ```

4. **浮動小数点数の引数**
   - `max(3.0)` のように浮動小数点数でも動作
   - 内部的に整数に変換される

### 関連メソッドとの比較

- **`min`**: 最小値を取得（max の逆）
- **`minmax`**: 最小値と最大値を同時に取得 `[min, max]`
- **`sort`**: 全要素をソート（max は上位 n 個のみ）
- **`max_by`**: ブロックの結果で比較（より簡潔な書き方）

**max vs max_by の違い：**
```ruby
# max: ブロックで比較ロジックを提供
words.max {|a, b| a.length <=> b.length }

# max_by: ブロックで比較する値を返す（より簡潔）
words.max_by {|word| word.length }
```

### パフォーマンスの考慮事項

- 計算量: O(n) - 配列を 1 回走査
- `max(n)` の場合: O(n log n) - ソートが必要
- 大量のデータで上位数個だけ必要な場合は、専用のヒープ構造の方が効率的な場合も
